<!DOCTYPE html>
<html>
<head>
    <title>Reports</title>
    <style>
        table { border-collapse: collapse; width: 80%; margin: 20px 0; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { cursor: pointer; background-color: #f2f2f2; }
    </style>
    <script>
        // Simple table sorting
        function sortTable(n) {
            let table = document.getElementById("reportTable");
            let switching = true, shouldSwitch, dir = "asc", switchcount = 0;
            while (switching) {
                switching = false;
                let rows = table.rows;
                for (let i = 1; i < (rows.length - 1); i++) {
                    shouldSwitch = false;
                    let x = rows[i].getElementsByTagName("TD")[n];
                    let y = rows[i + 1].getElementsByTagName("TD")[n];
                    if (dir == "asc") {
                        if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                            shouldSwitch = true; break;
                        }
                    } else if (dir == "desc") {
                        if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                            shouldSwitch = true; break;
                        }
                    }
                }
                if (shouldSwitch) {
                    rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                    switching = true;
                    switchcount++;
                } else if (switchcount == 0 && dir == "asc") {
                    dir = "desc"; switching = true;
                }
            }
        }
    </script>
</head>
<body>
    <h1>Reports</h1>

    <form method="POST" action="{{ url_for('reports') }}">
        <label for="report_type">Select Report:</label>
        <select name="report_type" id="report_type">
            <option value="">--Choose--</option>
            <option value="diagnosis_no_prescription" {% if report_type=='diagnosis_no_prescription' %}selected{% endif %}>
                Patients with Diagnosis but No Prescription
            </option>
            <option value="provider_most_medications" {% if report_type=='provider_most_medications' %}selected{% endif %}>
                Providers Prescribing Medications Most Often
            </option>
        </select>
        <button type="submit">Generate</button>
    </form>

    {% if results %}
        <table id="reportTable">
            <thead>
                <tr>
                    {% if report_type == "diagnosis_no_prescription" %}
                        <th onclick="sortTable(0)">Patient ID</th>
                        <th onclick="sortTable(1)">Patient Name</th>
                        <th onclick="sortTable(2)">Diagnosis</th>
                    {% elif report_type == "provider_most_medications" %}
                        <th onclick="sortTable(0)">Provider ID</th>
                        <th onclick="sortTable(1)">Provider Name</th>
                        <th onclick="sortTable(2)">Medication</th>
                        <th onclick="sortTable(3)">Count</th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                {% for row in results %}
                    <tr>
                        {% for value in row %}
                            <td>{{ value }}</td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
</body>
</html>
