{% extends "_base.html" %}
{% block content %}

<h2>Reports</h2>

<form method="post" action="/reports">
  <label for="report_type">Select a report:</label>
  <select name="report_type" id="report_type">
    <option value="">-- Select a report --</option>
    <option value="diagnosis_no_prescription"
      {% if report_type == "diagnosis_no_prescription" %}selected{% endif %}>
      Patients with a diagnosis but no prescription
    </option>
    <option value="provider_most_medications"
      {% if report_type == "provider_most_medications" %}selected{% endif %}>
      Providers prescribing medications most often
    </option>
  </select>
  <button type="submit">Generate</button>
</form>

<hr>

{% if results %}
  {% if report_type == "diagnosis_no_prescription" %}
    <h3>Patients with a diagnosis but no prescription</h3>
    <table>
      <tr><th>Patient</th><th>Diagnosis</th></tr>
      {% for r in results %}
      <tr><td>{{ r.patient_name }}</td><td>{{ r.diagnosis_name }}</td></tr>
      {% endfor %}
    </table>
  {% elif report_type == "provider_most_medications" %}
    <h3>Providers and their most prescribed medications</h3>
    <table>
      <tr><th>Provider</th><th>Medication</th><th>Count</th></tr>
      {% for r in results %}
      <tr><td>{{ r.provider_name }}</td><td>{{ r.medication_name }}</td><td>{{ r.count }}</td></tr>
      {% endfor %}
    </table>
  {% endif %}
{% elif report_type %}
  <p>No results found for this report.</p>
{% endif %}

<p><a href="{{ url_for('index') }}">Home</a></p>

{% endblock %}
